<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="utf-8">
    <title>Socket.io test</title>

    <style>
      body{
        background: black;
        color: white;
        text-align: center;
      }
      form{
        margin-top: 30px;
      }
    </style>
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js" integrity="sha384-Gr6Lu2Ajx28mzwyVR8CFkULdCU7kMlZ9UthllibdOSo6qAiN+yXNHqtgdTvFXMT4" crossorigin="anonymous"></script>
  </head>
  <body>
    <h1>Socket.io test</h1>
    <p>Connecting...</p>
    <section>None</section>

    <form id='end'>
      <input type="text" name="phrase" placeholder="End phrase" required>
      <button>Zakończ</button>
    </form>

    <form id='phrase'>
      <input type="text" name="phrase" placeholder="Phrase" required>
      <button>Zaakceptuj</button>
    </form>

    <form id='create'>
      <input type="text" name="name" placeholder="New game name" required>
      <button>Utwórz</button>
    </form>

    <script type="text/javascript">
      const p = document.querySelector('p');
      const section = document.querySelector('section');
      const create = document.querySelector('#create');
      const end = document.querySelector('#end');
      const socket = io('ws://127.0.0.1', { path: '/multi' });

      function join(id){
        socket.emit('join-game', id)
      }

      socket.on('connect', () => {
        p.innerText = socket.id;
        socket.emit('join-lobby')
      });

      socket.on('game-list', games => {
        if ([...Object.keys(games)].length < 1){
          section.innerText = 'Empty';
          return
        }
        let gameList = '';
        for (const game in games){
          gameList += `
            <div>
              ${games[game]}
              <button onclick="join('${game}')">Dołącz</button>
            </div>
          `;
        }
        section.innerHTML = gameList;
      });

      socket.on('wait-start', () => {
        section.innerText = 'Wait for opponent'
      });
      socket.on('give-phrase', () => {
        section.innerText = 'Enter phrase';
      });
      socket.on('opponent-exit', () => {
        section.innerText = 'opponent exit';
      });
      socket.on('start-game', phrase => {
        section.innerText = `Entry: ${phrase}`;
      });
      socket.on('game-data', data => {
        section.innerHTML = `
          <p>You: ${data.wins}/${data.rounds}</p>
          <p>Opponent: ${data.oWins}/${data.oRounds}</p>
          <button onclick="socket.emit('continue-game')">
            Continue
          </button>
        `;
      });

      create.addEventListener('submit', e => {
        e.preventDefault()
        socket.emit('create-game', e.target.name.value);
      });

      phrase.addEventListener('submit', e => {
        e.preventDefault()
        socket.emit('write-phrase', e.target.phrase.value);
      });

      end.addEventListener('submit', e => {
        e.preventDefault()
        socket.emit('end-game', e.target.phrase.value);
      });

    </script>
  </body>
</html>
